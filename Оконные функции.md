# Функции ранжирования  
<br>

## RANK  
Перед нами задача, составить рейтинг фильмов за декабрь 1990 г. по продолжительности.
<br>

```Было```
``` 
Title                              |Genre      |Duration|
-----------------------------------+-----------+--------+
Man forward.                       |Adventure  |     179|
Phone door.                        |Action     |     178|
Hot recently trip.                 |Comedy     |     178|
Future say bad.                    |Thriller   |     176|
From look.                         |Horror     |     176|
Question myself.                   |Fantasy    |     176|
Hour image special.                |Fantasy    |     173|
What boy.                          |Sci-Fi     |     172|
Democrat front.                    |Sci-Fi     |     168|
Point point.                       |Sci-Fi     |     163|
Yourself fear admit.               |Documentary|     163|
Message from.                      |Adventure  |     160|
Mother computer.                   |Fantasy    |     158|
Particular outside easy.           |Thriller   |     153|
Open participant painting practice.|Adventure  |     151|
Rest join upon.                    |Documentary|     151|
```
<br>

```Стало```
```
RANK|Title                              |Genre      |Duration
----+-----------------------------------+-----------+--------
   1|Man forward.                       |Adventure  |     179
   2|Phone door.                        |Action     |     178
   2|Hot recently trip.                 |Comedy     |     178
   4|Future say bad.                    |Thriller   |     176
   4|From look.                         |Horror     |     176
   4|Question myself.                   |Fantasy    |     176
   7|Hour image special.                |Fantasy    |     173
   8|What boy.                          |Sci-Fi     |     172
   9|Democrat front.                    |Sci-Fi     |     168
  10|Point point.                       |Sci-Fi     |     163
  10|Yourself fear admit.               |Documentary|     163
  12|Message from.                      |Adventure  |     160
  13|Mother computer.                   |Fantasy    |     158
  14|Particular outside easy.           |Thriller   |     153
  15|Open participant painting practice.|Adventure  |     151
  15|Rest join upon.                    |Documentary|     151
```
Обратите внимание, что фильмы с одинаковой продолжительностью получили один и тот же рейтинг, например, "Phone Door" и "Hot Recently Trip". Чтобы перейти от ```Было``` к ```Стало```, в первую очередь нужно отсортировать таблицу по убыванию продолжительности фильма. Далее нам нужно спускаться вниз построчно и "смотреть" на одно поле — **Duration** (продолжительность). В принципе, мы можем назвать эти значения окном, хотя это и не совсем так, но пока нам этого достаточно. Попробуем описать значения нашего окна: 1) это значения поля **Duration**; 2) они упорядочены по убыванию. Теперь нужно перенести эту логику на **SQL**. Взглянем для начала на запрос без оконной функции.
<br>

```Было```
```
SELECT Title,
       Genre,
       Duration	      
  FROM movies
 WHERE 1 = 1
   AND EXTRACT(YEAR FROM "Release Date") = 1990
   AND EXTRACT(month FROM "Release Date") = 12
 ORDER BY Duration DESC
```
<br>

```Стало```
```
SELECT RANK() OVER (ORDER BY Duration DESC) AS RANK,
       Title,
       Genre,
       Duration	      
  FROM movies
 WHERE 1 = 1
   AND EXTRACT(YEAR FROM "Release Date") = 1990
   AND EXTRACT(month FROM "Release Date") = 12
 ORDER BY RANK, Duration DESC
 ```
В исходную конструкцию мы добавили оконную функцию RANK ``` RANK() OVER (ORDER BY Duration DESC) AS RANK ``` логика которого заключается во второй части конструкции, которая гласит, что значения нашего окна, столбца Duration, мы упорядочили по убыванию.  
___

## DENSE_RANK
Оконные функции ```RANK()``` и ```DENSE_RANK()``` используются для присвоения рангов строкам в наборе данных на основе заданных критериев. Основное отличие между ними заключается в том, как они обрабатывают одинаковые значения.  
Основные отличия:  
* ```RANK()```: Если несколько строк имеют одинаковое значение, они получают одинаковый ранг, но следующий ранг пропускается. Например, если два значения имеют ранг 1, следующий ранг будет 3, а не 2.
* ```DENSE_RANK()```: В случае одинаковых значений, они также получают одинаковый ранг, но следующий ранг не пропускается. То есть, если два значения имеют ранг 1, следующий ранг будет 2.
<br>  

Давайте посмотрим на запрос и его результат.  
```
SELECT RANK() OVER (ORDER BY Duration DESC) AS RANK,
	    DENSE_RANK() OVER (ORDER BY Duration DESC) AS DENSE_RANK,
       Title,
	    Genre,
	    Duration	      
  FROM movies
 WHERE 1 = 1
   AND EXTRACT(YEAR FROM "Release Date") = 1990
   AND EXTRACT(month FROM "Release Date") = 12
 ORDER BY RANK, Duration DESC
 LIMIT 15;
```
<br>
```
RANK|DENSE_RANK|Title                              |Genre      |Duration|
----+----------+-----------------------------------+-----------+--------+
   1|         1|Man forward.                       |Adventure  |     179|
   2|         2|Phone door.                        |Action     |     178|
   2|         2|Hot recently trip.                 |Comedy     |     178|
   4|         3|Future say bad.                    |Thriller   |     176|
   4|         3|From look.                         |Horror     |     176|
   4|         3|Question myself.                   |Fantasy    |     176|
   7|         4|Hour image special.                |Fantasy    |     173|
   8|         5|What boy.                          |Sci-Fi     |     172|
   9|         6|Democrat front.                    |Sci-Fi     |     168|
  10|         7|Point point.                       |Sci-Fi     |     163|
  10|         7|Yourself fear admit.               |Documentary|     163|
  12|         8|Message from.                      |Adventure  |     160|
  13|         9|Mother computer.                   |Fantasy    |     158|
  14|        10|Particular outside easy.           |Thriller   |     153|
  15|        11|Open participant painting practice.|Adventure  |     151|
```
<br>  
  
Здесь наглядно показана разница между ```RANK``` и ```DENSE_RANK```, заключающаяся в том, как они обрабатывают одинаковые значения и присваивают последующие ранги.  
  
---

## ORDER BY окна и ORDER BY запроса
